<h2>Admin Dashboard</h2>

<h3>Messages</h3>
<ul id="messages-list">
    {% if messages %}
        {% for message in messages %}
            <li>
                <strong>Sender:</strong> {{ message.sender.username }} <br>
                <strong>Receiver:</strong> {{ message.receiver.username }} <br>
                <strong>Message:</strong> {{ message.content }} <br>
                <hr>
            </li>
        {% endfor %}
    {% else %}
        <p>No messages available.</p>
    {% endif %}
</ul>

<h3>All Users</h3>
{% if users %}
    <table class="table">
        <thead>
            <tr>
                <th>Username</th>
                <th>Email</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
                <tr>
                    <td>{{ user.username }}</td>
                    <td>{{ user.email }}</td>
                    <td>
                        <a href="{% url 'edit_user' user.id %}" class="btn btn-warning">Edit</a>
                        <a href="{% url 'delete_user' user.id %}" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this user?');">Delete</a>
                        <a href="{% url 'send_message' user.id %}" class="btn btn-primary">Send Message</a>
                        <a href="{% url 'view_user_messages' user.id %}" class="btn btn-info">View Messages</a>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p>No users available.</p>
{% endif %}

<h3>System Messages</h3>
{% if messages %}
    <ul class="messages">
        {% for message in messages %}
            <li class="message">{{ message }}</li>
        {% endfor %}
    </ul>
{% endif %}

<a href="{% url 'admin_logout' %}" class="btn btn-primary">Logout</a>

<!-- jQuery script inclusion just before the closing body tag -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- JavaScript to fetch and update messages -->
<script>
  // Function to fetch and update messages periodically
  function fetchMessages() {
      $.ajax({
          url: '{% url "message_list" %}',  // URL to your message API endpoint
          method: 'GET',
          success: function(response) {
              // Clear the current messages
              $('#messages-list').empty();

              // Append new messages to the list
              response.forEach(function(message) {
                  $('#messages-list').append(`
                      <li>
                          <strong>Sender:</strong> ${message.sender.username} <br>
                          <strong>Receiver:</strong> ${message.receiver.username} <br>
                          <strong>Message:</strong> ${message.content} <br>
                          <hr>
                      </li>
                  `);
              });
          },
          error: function(error) {
              console.log('Error fetching messages:', error);
          }
      });
  }

  // Call fetchMessages every 5 seconds (or adjust the interval as needed)
  setInterval(fetchMessages, 5000);  // 5000 ms = 5 seconds
</script>
